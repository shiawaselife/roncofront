import{k as xe,r as i,n as ge,v as p,x as se,y as ke,c as we,w as ae,_ as Te,o as n,a as Ce,b as e,d as o,u as z,z as Me,B as $e,C as h,D as Ie,p as A,t as l,E as Se,F as B,G as Ve,H as Ae,I as v,J as Be,K as G,L as N,j as Ne,q as Ue,s as De}from"./index-a961658a.js";import{d as _}from"./dayjs.min-91b9ea6a.js";const r=U=>(Ue("data-v-8db1cb1d"),U=U(),De(),U),Ee={class:"flex items-center mb-6"},je={class:"w-6 h-6 mr-2 text-blue-500",viewBox:"0 0 24 24"},Le=["d"],ze=r(()=>e("h1",{class:"text-2xl font-bold"},"출결 관리",-1)),He={class:"mb-4 flex space-x-2"},Fe={class:"bg-white p-4 rounded shadow mb-6"},Re={class:"flex items-center mb-4"},Oe={class:"w-5 h-5 mr-2 text-gray-600",viewBox:"0 0 24 24"},Pe=["d"],qe=r(()=>e("h2",{class:"text-lg font-semibold mr-4"},"출결 현황",-1)),Ge={class:"flex items-center cursor-pointer"},Je=r(()=>e("span",{class:"text-sm text-gray-700"},"전체 표시",-1)),Ke={class:"grid grid-cols-2 gap-6"},Qe=r(()=>e("h3",{class:"font-semibold mb-2"},"등원",-1)),We={class:"space-y-3"},Xe={class:"font-bold"},Ye={class:"text-sm text-gray-500"},Ze=["onClick"],et={class:"w-4 h-4",viewBox:"0 0 24 24"},tt=["d"],st=r(()=>e("h3",{class:"font-semibold mb-2"},"하원",-1)),at={class:"space-y-3"},nt={class:"flex items-center justify-between mb-2"},ot={class:"font-bold"},lt={key:0,class:"ml-2"},dt={key:0,class:"flex space-x-2"},it={class:"relative"},ut=["onClick"],rt={key:0,class:"absolute right-0 mt-1 w-24 bg-white border rounded shadow-lg z-10"},ct=["onClick"],mt=["onClick"],pt={class:"bg-white p-4 rounded shadow"},vt={class:"flex items-center mb-4"},_t={class:"w-5 h-5 mr-2 text-gray-600",viewBox:"0 0 24 24"},bt=["d"],ht=r(()=>e("h2",{class:"text-lg font-semibold"},"보강 목록",-1)),ft={class:"flex items-center mb-4 space-x-2"},yt=r(()=>e("option",{value:"week"},"주간",-1)),xt=r(()=>e("option",{value:"month"},"월간",-1)),gt=[yt,xt],kt=r(()=>e("option",{value:"asc"},"오름차순",-1)),wt=r(()=>e("option",{value:"desc"},"내림차순",-1)),Tt=[kt,wt],Ct={class:"space-y-2"},Mt={class:"font-bold"},$t={class:"text-sm text-gray-600"},It={class:"text-green-600 font-semibold"},St={key:0,class:"fixed inset-0 bg-black bg-opacity-40 flex items-center justify-center z-50"},Vt={class:"bg-white p-4 rounded w-80"},At={class:"text-lg font-semibold mb-2"},Bt={key:0,class:"text-sm text-gray-600 mb-4"},Nt={class:"space-y-2"},Ut={key:1,class:"fixed inset-0 bg-black bg-opacity-40 flex items-center justify-center z-50"},Dt={class:"bg-white p-4 rounded w-80"},Et={class:"text-lg font-semibold mb-2"},jt={key:0,class:"text-sm text-gray-600 mb-2"},Lt={key:1,class:"mb-4"},zt=r(()=>e("label",{class:"text-sm block mb-1"},"학생 선택:",-1)),Ht=r(()=>e("option",{value:""},"학생을 선택하세요",-1)),Ft=["value"],Rt=r(()=>e("label",{class:"text-sm block mb-1"},"보강 날짜:",-1)),Ot=r(()=>e("label",{class:"text-sm block mb-1"},"보강 시작시간:",-1)),Pt=r(()=>e("label",{class:"text-sm block mb-1"},"보강 종료시간:",-1)),qt={key:2,class:"fixed inset-0 bg-black bg-opacity-40 flex items-center justify-center z-50"},Gt={class:"bg-white p-4 rounded w-80"},Jt=r(()=>e("h3",{class:"text-lg font-semibold mb-2"},"수업 시간 수정",-1)),Kt={class:"text-sm text-gray-600 mb-4"},Qt={class:"space-y-4"},Wt=r(()=>e("label",{class:"text-sm block mb-1"},"시작 시간:",-1)),Xt=r(()=>e("label",{class:"text-sm block mb-1"},"종료 시간:",-1)),Yt={__name:"AttendanceManagement",setup(U){const H=i([]),F=i([]),R=i(!1),T=i(null),D=i(!1),O=i(!1),u=i(null),C=i(""),M=i(""),$=i(""),I=i(""),S=i(null),P=i(!1),f=i(""),y=i(""),E=i("week"),j=i("asc"),J=i([]),K=i([]);ge(()=>{x(),Q(),oe()});async function x(){try{const t=await p.get("/api/classes/today");H.value=t.data}catch(t){console.error(t),alert("오늘 수업 불러오기 실패")}}async function Q(){try{const t=await p.get("/api/attendance/today");F.value=t.data}catch(t){console.error(t),alert("오늘 등원 목록 조회 실패")}}async function ne(){try{await p.post("/api/classes/auto"),alert("오늘 수업이 자동 등록되었습니다."),x()}catch(t){console.error(t),alert("오늘 수업 자동 추가 중 오류가 발생했습니다.")}}async function W(){try{const t=await p.get("/api/classes/makeup",{params:{range:E.value,order:j.value}});J.value=t.data}catch(t){console.error(t),alert("보강 이력 조회 중 오류가 발생했습니다.")}}async function oe(){try{const t=await p.get("/api/students");K.value=t.data}catch(t){console.error(t),alert("학생 목록 불러오기 실패")}}function le(t){const a=_(),[d,c]=t.startTime.split(":"),[m,b]=t.endTime.split(":"),g=_().hour(Number(d)).minute(Number(c)).second(0).subtract(30,"minute"),k=_().hour(Number(m)).minute(Number(b)).second(0).add(30,"minute");return a.isAfter(g)&&a.isBefore(k)}function de(t){const[a,d]=t.split(":");return _().hour(Number(a)).minute(Number(d)).second(0)}function L(t){const a=_();return de(t.endTime).isBefore(a)}function ie(t){const a=_(),[d,c]=t.endTime.split(":"),b=_().hour(parseInt(d)).minute(parseInt(c)).diff(a,"minute");if(b>=60){const g=Math.floor(b/60),k=b%60;return`${g}시간 ${k}분`}return`${b}분`}function ue(t){T.value===t?T.value=null:T.value=t}async function re(t,a){try{const[d,c]=t.endTime.split(":"),m=_().hour(parseInt(d)).minute(parseInt(c)).add(a,"minute").format("HH:mm");await p.patch(`/api/classes/${t.id}`,{endTime:m}),x(),T.value=null}catch(d){console.error(d),alert("수업 시간 추가 중 오류가 발생했습니다.")}}function ce(t){u.value=t,f.value=t.startTime,y.value=t.endTime,P.value=!0}function X(){P.value=!1,u.value=null,f.value="",y.value=""}async function me(){if(!f.value||!y.value){alert("시작 시간과 종료 시간을 모두 입력해주세요.");return}try{await p.patch(`/api/classes/${u.value.id}`,{startTime:f.value,endTime:y.value}),alert("수업 시간이 수정되었습니다."),X(),x()}catch(t){console.error(t),alert("수업 시간 수정 중 오류가 발생했습니다.")}}function pe(t){return L(t)?t.isMakeup?"보강완료":"수업완료":"수업중"}function ve(t){return L(t)?t.isMakeup?"text-purple-600":"text-green-600":"text-orange-500"}const _e=se(()=>(_(),H.value.filter(t=>{const a=!F.value.some(d=>d.studentId===t.student.id);return R.value?a:a&&le(t)}))),be=se(()=>H.value.filter(t=>F.value.some(a=>a.studentId===t.student.id)));function Y(t){u.value=t,D.value=!0}function Z(){u.value=null,D.value=!1}function q(t){C.value=t,M.value="",$.value="",I.value="",D.value=!1,O.value=!0}function ee(){O.value=!1,C.value="",u.value=null,S.value=null}async function he(t){var a;try{const d=_(),c=new URLSearchParams;c.set("studentId",t.student.id),c.set("makeup",t.makeup),t.makeup&&c.set("makeupType",t.makeupType||"지각보강");const m=d.format("HH:mm");c.set("startTime",m),await p.post(`/api/attendance?${c.toString()}`),await p.patch(`/api/classes/${t.id}`,{startTime:m}),alert(`${t.student.name} 등원 기록이 등록되었습니다.`),Z(),x(),Q()}catch(d){alert(((a=d.response)==null?void 0:a.data)||d.message)}}async function fe(){var t;if(!M.value||!$.value||!I.value){alert("보강 날짜/시간을 모두 입력해주세요.");return}try{const a={student:u.value?{id:u.value.student.id}:S.value?{id:S.value}:null,startTime:$.value,endTime:I.value,classDate:M.value,makeup:!0,makeupType:C.value},d=await p.post("/api/classes",a);alert(`보강(${C.value}) 수업이 등록되었습니다. ID=${d.data.id}`),ee(),x(),W()}catch(a){alert(((t=a.response)==null?void 0:t.data)||a.message)}}return ke([E,j],()=>{W()},{immediate:!0}),(t,a)=>(n(),we(Te,null,{default:ae(()=>[Ce(Ne,null,{default:ae(()=>{var d,c,m,b,g,k,te;return[e("div",null,[e("div",Ee,[(n(),o("svg",je,[e("path",{fill:"currentColor",d:z(Me)},null,8,Le)])),ze]),e("div",He,[e("button",{class:"bg-green-500 text-white px-4 py-2 rounded shadow",onClick:ne}," 오늘 수업 자동 추가 "),e("button",{class:"bg-purple-500 text-white px-4 py-2 rounded shadow",onClick:a[0]||(a[0]=s=>Y(null))}," 보강 추가 ")]),e("div",Fe,[e("div",Re,[(n(),o("svg",Oe,[e("path",{fill:"currentColor",d:z($e)},null,8,Pe)])),qe,e("label",Ge,[h(e("input",{type:"checkbox",class:"mr-1","onUpdate:modelValue":a[1]||(a[1]=s=>R.value=s)},null,512),[[Ie,R.value]]),Je])]),e("div",Ke,[e("div",null,[Qe,e("ul",We,[(n(!0),o(B,null,A(_e.value,(s,ye)=>{var V;return n(),o("li",{key:s.id,class:"p-2 border rounded flex items-center justify-between"},[e("div",null,[e("div",Xe,l((V=s.student)==null?void 0:V.name)+" ("+l(s.startTime)+" ~ "+l(s.endTime)+") ",1),e("div",Ye," 수업ID: "+l(s.id),1)]),e("button",{class:"bg-blue-500 text-white px-3 py-1 rounded flex items-center",onClick:w=>Y(s)},[(n(),o("svg",et,[e("path",{fill:"currentColor",d:z(Se)},null,8,tt)]))],8,Ze)])}),128))])]),e("div",null,[st,e("ul",at,[(n(!0),o(B,null,A(be.value,(s,ye)=>{var V;return n(),o("li",{key:s.id,class:"p-2 border rounded"},[e("div",nt,[e("div",null,[e("div",ot,l((V=s.student)==null?void 0:V.name)+" ("+l(s.startTime)+" ~ "+l(s.endTime)+") ",1),e("div",{class:Ve(["text-sm",ve(s)])},[Ae(l(pe(s))+" ",1),L(s)?v("",!0):(n(),o("span",lt," ("+l(ie(s))+" 남음) ",1))],2)]),L(s)?v("",!0):(n(),o("div",dt,[e("div",it,[e("button",{class:"bg-yellow-500 text-white px-3 py-1 rounded",onClick:w=>ue(s.id)}," 시간 추가 ",8,ut),T.value===s.id?(n(),o("div",rt,[(n(),o(B,null,A([10,20,30,40,50,60],w=>e("button",{key:w,class:"block w-full text-left px-4 py-2 hover:bg-gray-100",onClick:Zt=>re(s,w)}," +"+l(w)+"분 ",9,ct)),64))])):v("",!0)]),e("button",{class:"bg-blue-500 text-white px-3 py-1 rounded",onClick:w=>ce(s)}," 시간 수정 ",8,mt)]))])])}),128))])])])]),e("div",pt,[e("div",vt,[(n(),o("svg",_t,[e("path",{fill:"currentColor",d:z(Be)},null,8,bt)])),ht]),e("div",ft,[h(e("select",{class:"border p-1 text-sm rounded","onUpdate:modelValue":a[2]||(a[2]=s=>E.value=s)},gt,512),[[G,E.value]]),h(e("select",{class:"border p-1 text-sm rounded","onUpdate:modelValue":a[3]||(a[3]=s=>j.value=s)},Tt,512),[[G,j.value]])]),e("ul",Ct,[(n(!0),o(B,null,A(J.value,s=>(n(),o("li",{key:s.id,class:"flex items-center justify-between bg-gray-50 p-2 rounded"},[e("div",null,[e("div",Mt,l(s.student.name),1),e("div",$t,l(s.classDate)+" ("+l(s.startTime)+" ~ "+l(s.endTime)+") ",1)]),e("div",It,l(s.makeupType),1)]))),128))])])]),D.value?(n(),o("div",St,[e("div",Vt,[e("h3",At,l(u.value?"수업 처리":"보강 추가"),1),u.value?(n(),o("p",Bt,l((c=(d=u.value)==null?void 0:d.student)==null?void 0:c.name)+" 수업 처리 방법을 선택하세요. ",1)):v("",!0),e("div",Nt,[u.value?(n(),o("button",{key:0,class:"bg-blue-500 text-white w-full py-1 rounded",onClick:a[4]||(a[4]=s=>he(u.value))}," 등원 기록 남기기 ")):v("",!0),e("button",{class:"bg-gray-200 text-gray-700 w-full py-1 rounded",onClick:a[5]||(a[5]=s=>q("결석보강"))}," 결석보강 "),e("button",{class:"bg-gray-200 text-gray-700 w-full py-1 rounded",onClick:a[6]||(a[6]=s=>q("공결보강"))}," 공결보강 "),e("button",{class:"bg-gray-200 text-gray-700 w-full py-1 rounded",onClick:a[7]||(a[7]=s=>q("지각보강"))}," 지각보강 ")]),e("button",{class:"mt-4 w-full bg-red-500 text-white py-1 rounded",onClick:Z}," 닫기 ")])])):v("",!0),O.value?(n(),o("div",Ut,[e("div",Dt,[e("h3",Et," 보강 일정 등록 ("+l(C.value)+") ",1),u.value?(n(),o("p",jt,l((b=(m=u.value)==null?void 0:m.student)==null?void 0:b.name)+" 학생 / 수업ID="+l((g=u.value)==null?void 0:g.id),1)):v("",!0),u.value?v("",!0):(n(),o("div",Lt,[zt,h(e("select",{"onUpdate:modelValue":a[8]||(a[8]=s=>S.value=s),class:"border p-1 w-full rounded"},[Ht,(n(!0),o(B,null,A(K.value,s=>(n(),o("option",{key:s.id,value:s.id},l(s.name),9,Ft))),128))],512),[[G,S.value]])])),Rt,h(e("input",{type:"date","onUpdate:modelValue":a[9]||(a[9]=s=>M.value=s),class:"border p-1 w-full rounded mb-2"},null,512),[[N,M.value]]),Ot,h(e("input",{type:"time","onUpdate:modelValue":a[10]||(a[10]=s=>$.value=s),class:"border p-1 w-full rounded mb-2"},null,512),[[N,$.value]]),Pt,h(e("input",{type:"time","onUpdate:modelValue":a[11]||(a[11]=s=>I.value=s),class:"border p-1 w-full rounded mb-4"},null,512),[[N,I.value]]),e("div",{class:"flex space-x-2"},[e("button",{class:"bg-blue-500 text-white flex-1 py-1 rounded",onClick:fe}," 등록 "),e("button",{class:"bg-red-500 text-white flex-1 py-1 rounded",onClick:ee}," 취소 ")])])])):v("",!0),P.value?(n(),o("div",qt,[e("div",Gt,[Jt,e("p",Kt,l((te=(k=u.value)==null?void 0:k.student)==null?void 0:te.name)+" 학생 ",1),e("div",Qt,[e("div",null,[Wt,h(e("input",{type:"time","onUpdate:modelValue":a[12]||(a[12]=s=>f.value=s),class:"border p-1 w-full rounded"},null,512),[[N,f.value]])]),e("div",null,[Xt,h(e("input",{type:"time","onUpdate:modelValue":a[13]||(a[13]=s=>y.value=s),class:"border p-1 w-full rounded"},null,512),[[N,y.value]])])]),e("div",{class:"flex space-x-2 mt-4"},[e("button",{class:"bg-blue-500 text-white flex-1 py-1 rounded",onClick:me}," 저장 "),e("button",{class:"bg-gray-300 text-gray-700 flex-1 py-1 rounded",onClick:X}," 취소 ")])])])):v("",!0)]}),_:1})]),_:1}))}},ss=xe(Yt,[["__scopeId","data-v-8db1cb1d"]]);export{ss as default};
