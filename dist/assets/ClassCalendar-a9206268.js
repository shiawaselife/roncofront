import{r as h,N as v,v as F,k as V,c as q,w as I,L as z,s as k,o as l,a as E,b as t,d as r,u as Y,aX as J,aY as X,t as g,aZ as Z,n as C,I as _,F as M,J as L,_ as G}from"./index-5d7e744c.js";const H={class:"p-6 min-h-screen bg-gray-50"},K={class:"bg-gradient-to-r from-blue-50 to-indigo-50 rounded-xl p-6 mb-6 shadow-sm"},P={class:"flex items-center"},Q={class:"w-8 h-8 text-blue-600",viewBox:"0 0 24 24"},U=["d"],W={class:"grid grid-cols-5 gap-6"},ee={class:"col-span-2"},te={class:"bg-white rounded-xl shadow-sm overflow-hidden sticky top-6"},se={class:"bg-gradient-to-b from-gray-50 border-b border-gray-100 p-4"},ae={class:"flex items-center justify-between"},ne={class:"w-5 h-5 text-gray-600",viewBox:"0 0 24 24"},oe=["d"],le={class:"text-lg font-semibold text-gray-800"},re={class:"w-5 h-5 text-gray-600",viewBox:"0 0 24 24"},ie=["d"],ue={class:"p-4"},ce={class:"grid grid-cols-7 gap-1"},de=["onClick"],ge={key:0,class:"absolute bottom-1 w-1.5 h-1.5 rounded-full bg-blue-400"},pe={class:"col-span-3"},xe={class:"bg-white rounded-xl shadow-sm overflow-hidden"},he={class:"border-b border-gray-100 p-6"},ve={class:"text-lg font-semibold text-gray-800"},fe={class:"p-6"},me={class:"overflow-x-auto"},ye={class:"w-full"},_e={class:"divide-y divide-gray-100"},be={class:"px-4 py-3 text-sm font-medium text-gray-900"},De={class:"px-4 py-3 text-sm"},we={key:0,class:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-red-100 text-red-800"},ke={key:1,class:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-purple-100 text-purple-800"},Ye={key:2,class:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800"},Ce={class:"px-4 py-3 text-sm text-gray-500"},Me={class:"px-4 py-3 text-sm text-center"},Se={key:0},Te={__name:"ClassCalendar",setup($e){const i=h(new Date().getFullYear()),u=h(new Date().getMonth()),x=h(v().format("YYYY-MM-DD")),f=h({}),m=h({}),b=h([]),N=F(()=>{const a=new Date(i.value,u.value,1),s=[],e=a.getDay(),d=new Date(i.value,u.value,0);for(let o=e-1;o>=0;o--){const p=new Date(i.value,u.value-1,d.getDate()-o).toISOString().split("T")[0];s.push({date:p,current:!1,hasRecords:D(p)})}const n=new Date(i.value,u.value+1,0);for(let o=1;o<=n.getDate();o++){const p=new Date(i.value,u.value,o).toISOString().split("T")[0];s.push({date:p,current:!0,hasRecords:D(p)})}const c=n.getDay();for(let o=1;o<7-c;o++){const p=new Date(i.value,u.value+1,o).toISOString().split("T")[0];s.push({date:p,current:!1,hasRecords:D(p)})}return s}),S=F(()=>{if(!x.value)return[];const a=(f.value[x.value]||[]).map(e=>({...e,type:"attendance"})),s=(m.value[x.value]||[]).map(e=>({...e,type:"absence"}));return[...a,...s].sort((e,d)=>{const n=w(e.studentId),c=w(d.studentId);return n.localeCompare(c)})});function D(a){return f.value[a]&&f.value[a].length>0||m.value[a]&&m.value[a].length>0}function $(a){const s=new Date(i.value,u.value+a,1);i.value=s.getFullYear(),u.value=s.getMonth(),T()}function A(a){x.value=a}function y(a){return x.value===a}function w(a){const s=b.value.find(e=>e.id===a);return s?s.name:`학생 #${a}`}function B(a){if(a.type==="absence")return"결석";{const s=v();if(v(a.attendanceDate).isAfter(s,"day"))return"예정";if(a.endTime){const d=v(`${a.attendanceDate} ${a.endTime}`);return s.isAfter(d)?"완료":"진행중"}return a.makeup?"보강":"출석"}}function j(a){switch(B(a)){case"예정":return"bg-gray-100 text-gray-600";case"진행중":return"bg-yellow-100 text-yellow-600";case"완료":return"bg-blue-100 text-blue-600";case"결석":return"bg-red-100 text-red-600";case"출석":case"보강":return"bg-green-100 text-green-600";default:return"bg-gray-100 text-gray-600"}}function O(a){const s=new Date(a),e=["일","월","화","수","목","금","토"];return`${s.getFullYear()}년 ${s.getMonth()+1}월 ${s.getDate()}일 (${e[s.getDay()]})`}async function T(){try{const a=v(new Date(i.value,u.value,1)).format("YYYY-MM-DD"),s=v(new Date(i.value,u.value+1,0)).format("YYYY-MM-DD");if(b.value.length===0){const n=await k.get("/api/students");b.value=n.data}const e=await k.get("/api/attendance/range",{params:{startDate:a,endDate:s}});f.value=e.data.reduce((n,c)=>{const o=c.attendanceDate;return n[o]||(n[o]=[]),n[o].push(c),n},{});const d=await k.get("/api/absence/range",{params:{startDate:a,endDate:s}});m.value=d.data.reduce((n,c)=>{const o=c.absenceDate;return n[o]||(n[o]=[]),n[o].push(c),n},{})}catch(a){console.error("데이터 조회 실패:",a),alert("데이터를 불러오는데 실패했습니다.")}}return V(()=>{T()}),(a,s)=>(l(),q(z,null,{default:I(()=>[E(G,null,{default:I(()=>[t("div",H,[t("div",K,[t("div",P,[(l(),r("svg",Q,[t("path",{fill:"currentColor",d:Y(J)},null,8,U)])),s[2]||(s[2]=t("h1",{class:"text-2xl font-bold text-gray-800 ml-3"},"날짜별 출결 현황",-1))])]),t("div",W,[t("div",ee,[t("div",te,[t("div",se,[t("div",ae,[t("button",{class:"p-2 hover:bg-gray-100 rounded-lg transition-colors",onClick:s[0]||(s[0]=e=>$(-1))},[(l(),r("svg",ne,[t("path",{fill:"currentColor",d:Y(X)},null,8,oe)]))]),t("h2",le,g(i.value)+"년 "+g(u.value+1)+"월 ",1),t("button",{class:"p-2 hover:bg-gray-100 rounded-lg transition-colors",onClick:s[1]||(s[1]=e=>$(1))},[(l(),r("svg",re,[t("path",{fill:"currentColor",d:Y(Z)},null,8,ie)]))])])]),t("div",ue,[t("div",ce,[(l(),r(M,null,C(["일","월","화","수","목","금","토"],e=>t("div",{key:e,class:_(["text-center py-2 text-sm font-medium",e==="일"?"text-red-500":e==="토"?"text-blue-500":"text-gray-600"])},g(e),3)),64)),(l(!0),r(M,null,C(N.value,({date:e,current:d,hasRecords:n})=>(l(),r("div",{key:e,class:"aspect-square p-0.5"},[t("button",{class:_(["w-full h-full rounded-lg flex flex-col items-center justify-center relative transition-all duration-200",[d?"hover:bg-blue-50":"opacity-30",y(e)?"bg-blue-500 text-white hover:bg-blue-600 shadow-sm":"",n&&!y(e)?"bg-blue-50":""]]),onClick:c=>A(e)},[t("span",{class:_(["text-sm",y(e)?"font-semibold":""])},g(new Date(e).getDate()),3),n&&!y(e)?(l(),r("div",ge)):L("",!0)],10,de)]))),128))])])])]),t("div",pe,[t("div",xe,[t("div",he,[t("h3",ve,g(x.value?O(x.value):"날짜를 선택하세요"),1)]),t("div",fe,[t("div",me,[t("table",ye,[s[4]||(s[4]=t("thead",null,[t("tr",{class:"border-b border-gray-100"},[t("th",{class:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"학생"),t("th",{class:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"종류"),t("th",{class:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"시간"),t("th",{class:"px-4 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider"},"상태")])],-1)),t("tbody",_e,[(l(!0),r(M,null,C(S.value,e=>(l(),r("tr",{key:`${e.type}-${e.id}`,class:"hover:bg-gray-50 transition-colors"},[t("td",be,g(w(e.studentId)),1),t("td",De,[e.type==="absence"?(l(),r("span",we," 결석 ")):e.makeup?(l(),r("span",ke,g(e.makeupType||"보강"),1)):(l(),r("span",Ye," 일반 출석 "))]),t("td",Ce,g(e.type==="absence"?"-":`${e.startTime||"-"} ~ ${e.endTime||"-"}`),1),t("td",Me,[t("span",{class:_(["inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium",j(e)])},g(B(e)),3)])]))),128)),S.value.length===0?(l(),r("tr",Se,s[3]||(s[3]=[t("td",{colspan:"4",class:"px-4 py-8 text-center text-gray-500"}," 이 날짜에는 출결 기록이 없습니다. ",-1)]))):L("",!0)])])])])])])])])]),_:1})]),_:1}))}};export{Te as default};
