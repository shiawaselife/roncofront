import{j as ct,r as c,v as E,x as q,k as ut,c as mt,w as tt,L as gt,s as y,o as u,a as xt,b as t,E as b,K as pt,d as g,n as j,t as n,F as L,G as S,C as D,J as T,I as A,_ as vt}from"./index-5d7e744c.js";const ft={class:"bg-white rounded-xl shadow-md overflow-hidden"},yt={class:"p-4 bg-gray-50 border-b border-gray-200"},bt={class:"flex flex-wrap gap-4"},wt={class:"w-full md:w-64"},ht=["value"],_t={class:"w-full md:w-64"},kt={class:"w-full md:w-64"},Ct={class:"w-full md:w-64"},St={class:"flex gap-2"},It={class:"overflow-x-auto"},$t={class:"min-w-full divide-y divide-gray-200"},Dt={class:"bg-white divide-y divide-gray-200"},Tt={key:0},At={key:1},Nt={class:"px-6 py-4 whitespace-nowrap"},Vt={class:"flex items-center"},Pt={class:"flex-shrink-0 h-10 w-10 bg-indigo-100 rounded-full flex items-center justify-center"},Et={class:"text-indigo-800 font-medium"},jt={class:"ml-4"},Lt={class:"text-sm font-medium text-gray-900"},Mt={class:"text-sm text-gray-500"},Ut={class:"px-6 py-4 whitespace-nowrap"},Ht={class:"text-sm text-gray-900"},Bt={class:"px-6 py-4 whitespace-nowrap"},Ft={class:"text-xs text-gray-500"},Ot={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},Rt={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},zt={class:"px-6 py-4 whitespace-nowrap text-sm space-x-2"},Yt=["onClick"],Kt=["onClick"],Wt={class:"px-6 py-4 bg-gray-50 border-t border-gray-200 flex items-center justify-between"},Gt={class:"text-sm text-gray-700"},Jt={class:"font-medium"},Qt={class:"flex-1 flex justify-end"},Xt={class:"relative z-0 inline-flex shadow-sm -space-x-px","aria-label":"Pagination"},Zt=["disabled"],qt={class:"relative inline-flex items-center px-4 py-2 border border-gray-300 bg-white text-sm font-medium text-gray-700"},te=["disabled"],ee={key:0,class:"fixed inset-0 overflow-y-auto z-50"},se={class:"flex items-center justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0"},oe={class:"inline-block align-bottom bg-white rounded-lg text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-4xl sm:w-full"},ne={class:"bg-white px-4 pt-5 pb-4 sm:p-6 sm:pb-4"},ae={class:"sm:flex sm:items-start"},ie={class:"w-full"},re={class:"flex justify-between items-center mb-4"},de={class:"text-lg leading-6 font-medium text-gray-900"},le={class:"text-sm text-gray-500"},ce={class:"bg-indigo-50 rounded-lg p-4 mb-6"},ue={class:"grid grid-cols-1 md:grid-cols-3 gap-4"},me={class:"text-lg font-medium text-gray-900"},ge={class:"text-lg font-medium text-gray-900"},xe={class:"space-y-4"},pe={class:"px-4 py-3 bg-gray-50 border-b flex justify-between items-center"},ve={class:"font-medium text-gray-900"},fe={class:"text-sm"},ye={class:"p-4"},be={class:"text-gray-900 mb-4"},we={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},he={class:"p-3 bg-gray-50 rounded border border-gray-200 text-gray-800"},_e={key:0},ke={class:"p-3 bg-green-50 rounded border border-green-200 text-gray-800"},Ce={key:0,class:"mt-4"},Se={class:"text-sm font-medium text-gray-700 mb-1"},Ie={class:"flex items-center gap-2"},$e=["onUpdate:modelValue","max"],De=["onClick"],Te={class:"bg-gray-50 px-4 py-3 sm:px-6 sm:flex sm:flex-row-reverse"},w="/api",M=10,Ae={__name:"TestResultView",setup(Ne){const N=c(!0),V=c([]),U=c([]),H=c([]),h=c(""),_=c(""),x=c(null),k=c(""),C=c(""),m=c(1),I=c(!1),i=c(null),p=E(()=>{let o=H.value;if(h.value&&(o=o.filter(e=>e.testId===Number(h.value))),_.value){const e=_.value.toLowerCase();o=o.filter(a=>a.studentName.toLowerCase().includes(e))}if(x.value!==null&&x.value!==""){const e=Number(x.value);o=o.filter(a=>a.score/a.totalScore*100>=e)}if(k.value){const e=new Date(k.value);e.setHours(0,0,0,0),o=o.filter(a=>new Date(a.submittedAt)>=e)}if(C.value){const e=new Date(C.value);e.setHours(23,59,59,999),o=o.filter(a=>new Date(a.submittedAt)<=e)}return o}),et=E(()=>{const o=(m.value-1)*M,e=o+M;return p.value.slice(o,e)}),v=E(()=>Math.ceil(p.value.length/M)||1),B=o=>o?new Date(o).toLocaleString("ko-KR",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}):"",st=o=>{switch(o){case"MULTIPLE_CHOICE":return"객관식";case"SHORT_ANSWER":return"주관식";case"ESSAY":return"서술형";default:return o}},ot=o=>o?o.charAt(0):"",nt=async()=>{try{const o=await y.get(`${w}/tests`);V.value=o.data}catch(o){console.error("시험 로드 실패:",o),alert("시험 정보를 불러오는데 실패했습니다.")}},at=async()=>{try{const o=await y.get(`${w}/students`);U.value=o.data}catch(o){console.error("학생 정보 로드 실패:",o)}},P=async()=>{N.value=!0;try{const o=await y.get(`${w}/test-results`);H.value=o.data.map(e=>{const a=U.value.find(l=>l.id===e.studentId),d=V.value.find(l=>l.id===e.testId);return{...e,studentName:a?a.name:`학생 ID: ${e.studentId}`,testTitle:d?d.title:`시험 ID: ${e.testId}`}})}catch(o){console.error("시험 결과 로드 실패:",o),alert("시험 결과를 불러오는데 실패했습니다.")}finally{N.value=!1}},F=async o=>{try{return(await y.get(`${w}/test-results/${o}`)).data}catch(e){return console.error("결과 상세 정보 로드 실패:",e),alert("상세 정보를 불러오는데 실패했습니다."),null}},it=async o=>{if(confirm("정말로 이 시험 결과를 삭제하시겠습니까? 이 작업은 되돌릴 수 없습니다."))try{await y.delete(`${w}/test-results/${o}`),await P(),alert("시험 결과가 삭제되었습니다.")}catch(e){console.error("결과 삭제 실패:",e),alert("시험 결과를 삭제하는데 실패했습니다.")}},rt=async(o,e,a)=>{try{await y.put(`${w}/test-results/${o}/questions/${e}/score`,{score:a}),alert("점수가 업데이트되었습니다.");const d=await F(o);d&&(i.value=d),await P()}catch(d){console.error("점수 업데이트 실패:",d),alert("점수를 업데이트하는데 실패했습니다.")}},dt=()=>{const o=[["학생 ID","학생 이름","시험 ID","시험 제목","점수","총점","백분율","소요 시간(초)","제출 일시"]];p.value.forEach(r=>{o.push([r.studentId,r.studentName,r.testId,r.testTitle,r.score,r.totalScore,Math.round(r.score/r.totalScore*100),r.duration,r.submittedAt])});const e=o.map(r=>r.map(f=>typeof f=="string"?`"${f.replace(/"/g,'""')}"`:f).join(",")).join(`
`),a=new Blob([e],{type:"text/csv;charset=utf-8;"}),d=URL.createObjectURL(a),l=document.createElement("a");l.setAttribute("href",d),l.setAttribute("download",`test-results-${new Date().toISOString().slice(0,10)}.csv`),document.body.appendChild(l),l.click(),document.body.removeChild(l)},lt=async o=>{try{const e=await F(o.id);e&&(i.value={...e,studentName:o.studentName,testTitle:o.testTitle},I.value=!0)}catch(e){console.error("결과 상세 정보 로드 실패:",e)}};return q([h,_,x,k,C],()=>{m.value=1}),q(p,()=>{m.value>v.value&&v.value>0&&(m.value=v.value)}),ut(async()=>{await nt(),await at(),await P()}),(o,e)=>(u(),mt(gt,null,{default:tt(()=>[xt(vt,null,{default:tt(()=>{var a,d,l,r,f,O,R,z,Y,K,W,G,J,Q;return[t("div",ft,[e[20]||(e[20]=t("div",{class:"px-6 py-4 bg-gradient-to-r from-indigo-600 to-blue-600"},[t("h2",{class:"text-xl font-bold text-white"},"시험 결과 관리")],-1)),t("div",yt,[t("div",bt,[t("div",wt,[e[10]||(e[10]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"시험",-1)),b(t("select",{"onUpdate:modelValue":e[0]||(e[0]=s=>h.value=s),class:"w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500"},[e[9]||(e[9]=t("option",{value:""},"전체 시험",-1)),(u(!0),g(L,null,j(V.value,s=>(u(),g("option",{key:s.id,value:s.id},n(s.title),9,ht))),128))],512),[[pt,h.value]])]),t("div",_t,[e[11]||(e[11]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"학생",-1)),b(t("input",{type:"text","onUpdate:modelValue":e[1]||(e[1]=s=>_.value=s),placeholder:"학생 이름 검색",class:"w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500"},null,512),[[S,_.value]])]),t("div",kt,[e[12]||(e[12]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"최소 점수",-1)),b(t("input",{type:"number","onUpdate:modelValue":e[2]||(e[2]=s=>x.value=s),min:"0",max:"100",placeholder:"0",class:"w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500"},null,512),[[S,x.value,void 0,{number:!0}]])]),t("div",Ct,[e[13]||(e[13]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"날짜 범위",-1)),t("div",St,[b(t("input",{type:"date","onUpdate:modelValue":e[3]||(e[3]=s=>k.value=s),class:"w-1/2 px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500"},null,512),[[S,k.value]]),b(t("input",{type:"date","onUpdate:modelValue":e[4]||(e[4]=s=>C.value=s),class:"w-1/2 px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500"},null,512),[[S,C.value]])])])]),t("div",{class:"mt-4 flex justify-end"},[t("button",{onClick:dt,class:"inline-flex items-center px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500"},e[14]||(e[14]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5 mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})],-1),D(" 결과 내보내기 (CSV) ")]))])]),t("div",It,[t("table",$t,[e[17]||(e[17]=t("thead",{class:"bg-gray-50"},[t("tr",null,[t("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"학생"),t("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"시험"),t("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"점수"),t("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"시간(분)"),t("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"제출 날짜"),t("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"작업")])],-1)),t("tbody",Dt,[N.value?(u(),g("tr",Tt,e[15]||(e[15]=[t("td",{colspan:"6",class:"px-6 py-4 text-center text-sm text-gray-500"},"로딩 중...",-1)]))):p.value.length===0?(u(),g("tr",At,e[16]||(e[16]=[t("td",{colspan:"6",class:"px-6 py-4 text-center text-sm text-gray-500"},"결과가 없습니다.",-1)]))):T("",!0),(u(!0),g(L,null,j(et.value,s=>(u(),g("tr",{key:s.id,class:"hover:bg-gray-50"},[t("td",Nt,[t("div",Vt,[t("div",Pt,[t("span",Et,n(ot(s.studentName)),1)]),t("div",jt,[t("div",Lt,n(s.studentName),1),t("div",Mt,"ID: "+n(s.studentId),1)])])]),t("td",Ut,[t("div",Ht,n(s.testTitle),1)]),t("td",Bt,[t("div",{class:A(["text-sm font-semibold",{"text-green-600":s.score>=80,"text-yellow-600":s.score>=60&&s.score<80,"text-red-600":s.score<60}])},n(s.score)+" / "+n(s.totalScore),3),t("div",Ft,n(Math.round(s.score/s.totalScore*100))+"%",1)]),t("td",Ot,n(Math.floor(s.duration/60))+"분 "+n(s.duration%60)+"초 ",1),t("td",Rt,n(B(s.submittedAt)),1),t("td",zt,[t("button",{onClick:$=>lt(s),class:"text-indigo-600 hover:text-indigo-900"}," 상세 보기 ",8,Yt),t("button",{onClick:$=>it(s.id),class:"text-red-600 hover:text-red-900"}," 삭제 ",8,Kt)])]))),128))])])]),t("div",Wt,[t("div",Gt,[e[18]||(e[18]=D(" 총 ")),t("span",Jt,n(p.value.length),1),e[19]||(e[19]=D(" 결과 "))]),t("div",Qt,[t("nav",Xt,[t("button",{onClick:e[5]||(e[5]=s=>m.value>1?m.value--:null),disabled:m.value===1,class:"relative inline-flex items-center px-2 py-2 rounded-l-md border border-gray-300 bg-white text-sm font-medium text-gray-500 hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed"}," 이전 ",8,Zt),t("span",qt,n(m.value)+" / "+n(v.value),1),t("button",{onClick:e[6]||(e[6]=s=>m.value<v.value?m.value++:null),disabled:m.value===v.value,class:"relative inline-flex items-center px-2 py-2 rounded-r-md border border-gray-300 bg-white text-sm font-medium text-gray-500 hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed"}," 다음 ",8,te)])])])]),I.value?(u(),g("div",ee,[t("div",se,[t("div",{class:"fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity",onClick:e[7]||(e[7]=s=>I.value=!1)}),t("div",oe,[t("div",ne,[t("div",ae,[t("div",ie,[t("div",re,[t("h3",de,n((a=i.value)==null?void 0:a.studentName)+"님의 시험 결과 ",1),t("div",le,n(B((d=i.value)==null?void 0:d.submittedAt)),1)]),t("div",ce,[t("div",ue,[t("div",null,[e[21]||(e[21]=t("div",{class:"text-sm text-gray-500"},"시험",-1)),t("div",me,n((l=i.value)==null?void 0:l.testTitle),1)]),t("div",null,[e[22]||(e[22]=t("div",{class:"text-sm text-gray-500"},"점수",-1)),t("div",{class:A(["text-lg font-medium",{"text-green-600":((r=i.value)==null?void 0:r.score)>=80,"text-yellow-600":((f=i.value)==null?void 0:f.score)>=60&&((O=i.value)==null?void 0:O.score)<80,"text-red-600":((R=i.value)==null?void 0:R.score)<60}])},n((z=i.value)==null?void 0:z.score)+" / "+n((Y=i.value)==null?void 0:Y.totalScore)+" ("+n(Math.round(((K=i.value)==null?void 0:K.score)/((W=i.value)==null?void 0:W.totalScore)*100))+"%) ",3)]),t("div",null,[e[23]||(e[23]=t("div",{class:"text-sm text-gray-500"},"소요 시간",-1)),t("div",ge,n(Math.floor(((G=i.value)==null?void 0:G.duration)/60))+"분 "+n(((J=i.value)==null?void 0:J.duration)%60)+"초 ",1)])])]),e[26]||(e[26]=t("h4",{class:"font-medium text-gray-900 mb-2"},"문제별 결과",-1)),t("div",xe,[(u(!0),g(L,null,j((Q=i.value)==null?void 0:Q.questionResults,(s,$)=>(u(),g("div",{key:$,class:"border rounded-lg overflow-hidden"},[t("div",pe,[t("div",ve,[D(" 문제 "+n($+1)+" ",1),t("span",{class:A(["ml-2 px-2 inline-flex text-xs leading-5 font-semibold rounded-full",{"bg-green-100 text-green-800":s.type==="MULTIPLE_CHOICE","bg-blue-100 text-blue-800":s.type==="SHORT_ANSWER","bg-purple-100 text-purple-800":s.type==="ESSAY"}])},n(st(s.type)),3)]),t("div",fe,[t("span",{class:A(["font-medium",{"text-green-600":s.correct,"text-red-600":!s.correct}])},n(s.earnedPoints)+" / "+n(s.totalPoints)+" 점 ",3)])]),t("div",ye,[t("div",be,n(s.content),1),t("div",we,[t("div",null,[e[24]||(e[24]=t("div",{class:"text-sm font-medium text-gray-500 mb-1"},"제출한 답안",-1)),t("div",he,n(s.userAnswer||"(제출 없음)"),1)]),s.correctAnswer?(u(),g("div",_e,[e[25]||(e[25]=t("div",{class:"text-sm font-medium text-gray-500 mb-1"},"정답",-1)),t("div",ke,n(s.correctAnswer),1)])):T("",!0)]),s.type==="ESSAY"?(u(),g("div",Ce,[t("div",Se,"점수 평가 (배점: "+n(s.totalPoints)+"점)",1),t("div",Ie,[b(t("input",{type:"number","onUpdate:modelValue":X=>s.earnedPoints=X,min:0,max:s.totalPoints,class:"w-20 px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500"},null,8,$e),[[S,s.earnedPoints,void 0,{number:!0}]]),t("button",{onClick:X=>{var Z;return rt((Z=i.value)==null?void 0:Z.id,s.questionId,s.earnedPoints)},class:"inline-flex items-center px-3 py-2 border border-transparent text-sm leading-4 font-medium rounded-md text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500"}," 저장 ",8,De)])])):T("",!0)])]))),128))])])])]),t("div",Te,[t("button",{onClick:e[8]||(e[8]=s=>I.value=!1),type:"button",class:"w-full inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-indigo-600 text-base font-medium text-white hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 sm:ml-3 sm:w-auto sm:text-sm"}," 닫기 ")])])])])):T("",!0)]}),_:1})]),_:1}))}},Pe=ct(Ae,[["__scopeId","data-v-7dc6c463"]]);export{Pe as default};
