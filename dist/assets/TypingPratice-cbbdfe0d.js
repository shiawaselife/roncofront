import{j as F,r as n,v as P,k as B,d as x,b as t,K as S,t as r,F as N,n as U,H as W,I as H,ab as R,S as V,M as G,s as D,o as m}from"./index-5fc67d8a.js";const J={class:"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8"},O={class:"bg-white rounded-lg shadow mb-6 p-4"},Q={class:"flex justify-center gap-4"},X={class:"bg-white rounded-lg shadow mb-6"},Y={class:"grid grid-cols-4 gap-4 p-4"},Z={class:"text-center"},ee={class:"mt-1 text-2xl font-semibold text-gray-900"},te={class:"text-center border-l border-gray-200"},se={class:"mt-1 text-2xl font-semibold text-gray-900"},ae={class:"text-center border-l border-gray-200"},oe={class:"text-sm font-medium text-gray-500"},le={class:"mt-1 text-2xl font-semibold text-gray-900"},ne={class:"text-center border-l border-gray-200"},re={class:"mt-1 text-2xl font-semibold text-gray-900"},ie={class:"bg-white rounded-lg shadow p-6 mb-6"},ue={class:"text-lg leading-relaxed whitespace-pre-wrap"},ce={class:"bg-white rounded-lg shadow p-6 mb-6"},de=["disabled","placeholder"],ve={class:"flex justify-center gap-4"},ge={class:"bg-white rounded-lg max-w-md w-full mx-4"},fe={class:"p-6"},pe={class:"space-y-4"},xe={class:"flex justify-between items-center"},me={class:"text-xl font-semibold text-gray-900"},ye={class:"flex justify-between items-center"},be={class:"text-xl font-semibold text-gray-900"},he={class:"flex justify-between items-center"},_e={class:"text-xl font-semibold text-gray-900"},we={class:"flex justify-between items-center"},ke={class:"text-xl font-semibold text-gray-900"},Ce={__name:"TypingPratice",setup(Te){const u=n(""),a=n(""),g=n(!1),v=n(null),y=n(0),p=n(60),b=n(null),f=n(!1),h=n(!1),i=n("en"),c=n(null),K=n(!1),_=P(()=>{if(!a.value.length)return 0;let s=0;for(let e=0;e<a.value.length;e++)a.value[e]===u.value[e]&&s++;return Math.round(s/a.value.length*100)}),A=s=>{let e=0;for(let o=0;o<s.length;o++){const l=s[o];/[가-힣]/.test(l)?(l.charCodeAt(0)>44032&&e++,(l.charCodeAt(0)-44032)%28>0&&e++,(l.charCodeAt(0)-44032)%28>0&&e++):e++}return e},w=P(()=>{if(!v.value||!a.value.length)return 0;const s=(Date.now()-v.value)/1e3/60,e=A(a.value);return Math.round(e/s)}),k=P(()=>{if(!v.value||!a.value.length)return 0;const s=(Date.now()-v.value)/1e3/60,e=A(a.value);return Math.round(e/8/s)}),L=s=>{if(i.value==="en"){const e=s.target,o=e.value,l=e.selectionStart,d=o.replace(/[가-힣ㄱ-ㅎㅏ-ㅣ]/g,"");o!==d&&(e.value=d,a.value=d,requestAnimationFrame(()=>{e.setSelectionRange(l,l)}))}!g.value&&a.value.length>0&&z(),q()},q=()=>{y.value=a.value.length,a.value.length===u.value.length&&M()},z=()=>{g.value=!0,v.value=Date.now(),b.value=setInterval(()=>{p.value--,p.value<=0&&(h.value=!0,M())},1e3)},M=()=>{g.value=!1,clearInterval(b.value),f.value=!0,$()},$=async()=>{try{await D.post("/api/typing/results",{studentId:localStorage.getItem("studentId"),cpm:w.value,wpm:k.value,accuracy:_.value,textLength:u.value.length,completedLength:a.value.length})}catch(s){console.error("결과 저장 실패:",s)}},C=()=>{clearInterval(b.value),a.value="",c.value&&(c.value.value=""),g.value=!1,v.value=null,y.value=0,p.value=60,h.value=!1,f.value=!1,K.value=!1,j()},T=()=>{f.value=!1,C()},E=async s=>{i.value=s,c.value&&(c.value.value="",a.value="",c.value.blur(),setTimeout(()=>{c.value.focus();const e=new KeyboardEvent("keydown",{key:"Shift",code:"ShiftLeft",altKey:!0,bubbles:!0});c.value.dispatchEvent(e)},100)),g.value?C():await j()},j=async()=>{try{const s=await D.get(`/api/typing/texts/random?language=${i.value}`);s.data&&s.data.content?u.value=s.data.content:u.value=i.value==="en"?"The quick brown fox jumps over the lazy dog. This is a sample text for typing practice.":"타자 연습을 위한 기본 텍스트입니다. 이것은 서버 연결에 실패했을 때 표시됩니다."}catch(s){console.error("텍스트 가져오기 실패:",s),u.value=i.value==="en"?"The quick brown fox jumps over the lazy dog. This is a sample text for typing practice.":"타자 연습을 위한 기본 텍스트입니다. 이것은 서버 연결에 실패했을 때 표시됩니다."}},I=s=>{if(i.value==="en"){s.preventDefault();const e=s.target,o=e.value,l=e.selectionStart,d=o.replace(/[가-힣ㄱ-ㅎㅏ-ㅣ]/g,"");o!==d&&(e.value=d,a.value=d,e.setSelectionRange(l,l),e.blur(),requestAnimationFrame(()=>{e.focus()}))}};return B(()=>{j().catch(()=>{u.value=i.value==="en"?"The quick brown fox jumps over the lazy dog. This is a sample text for typing practice.":"타자 연습을 위한 기본 텍스트입니다. 이것은 서버 연결에 실패했을 때 표시됩니다."})}),(s,e)=>(m(),x("div",J,[t("div",O,[t("div",Q,[t("button",{onClick:e[0]||(e[0]=o=>E("en")),class:S(["px-4 py-2 rounded-lg font-medium",i.value==="en"?"bg-blue-600 text-white":"bg-gray-200 text-gray-700 hover:bg-gray-300"])}," English ",2),t("button",{onClick:e[1]||(e[1]=o=>E("ko")),class:S(["px-4 py-2 rounded-lg font-medium",i.value==="ko"?"bg-blue-600 text-white":"bg-gray-200 text-gray-700 hover:bg-gray-300"])}," 한글 ",2)])]),t("div",X,[t("div",Y,[t("div",Z,[e[5]||(e[5]=t("div",{class:"text-sm font-medium text-gray-500"},"정확도",-1)),t("div",ee,r(_.value)+"%",1)]),t("div",te,[e[6]||(e[6]=t("div",{class:"text-sm font-medium text-gray-500"},r("분당 타자수"),-1)),t("div",se,r(w.value),1)]),t("div",ae,[t("div",oe,r(i.value==="ko"?"분당 단어수":"WPM"),1),t("div",le,r(k.value),1)]),t("div",ne,[e[7]||(e[7]=t("div",{class:"text-sm font-medium text-gray-500"},"남은 시간",-1)),t("div",re,r(p.value)+"초",1)])])]),t("div",ie,[t("div",ue,[(m(!0),x(N,null,U(u.value,(o,l)=>(m(),x("span",{key:l,class:S({"text-gray-600":!a.value[l],"text-green-500":a.value[l]===o,"text-red-500 underline":a.value[l]&&a.value[l]!==o,"bg-blue-50":y.value===l})},r(o),3))),128))])]),t("div",ce,[W(t("textarea",{ref_key:"textareaRef",ref:c,"onUpdate:modelValue":e[2]||(e[2]=o=>a.value=o),onInput:L,onKeydown:e[3]||(e[3]=R(V(()=>{},["prevent"]),["enter"])),onCompositionstart:I,onCompositionupdate:I,onCompositionend:I,disabled:h.value||f.value,placeholder:i.value==="en"?"Start typing in English...":"타이핑을 시작하면 자동으로 시작됩니다...",class:"w-full h-32 p-4 text-lg border border-gray-300 rounded-lg resize-none focus:ring-2 focus:ring-blue-500 focus:border-transparent disabled:bg-gray-50 disabled:text-gray-500"},null,40,de),[[H,a.value]])]),t("div",ve,[t("button",{onClick:C,class:"px-6 py-3 text-lg font-medium text-white bg-gray-600 rounded-lg hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-500 transition-colors"}," 재시작 "),t("button",{onClick:e[4]||(e[4]=o=>s.$router.push("/s")),class:"px-6 py-3 text-lg font-medium text-white bg-red-600 rounded-lg hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500 transition-colors"}," 나가기 ")]),f.value?(m(),x("div",{key:0,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center",onClick:V(T,["self"]),onKeydown:R(T,["esc"]),tabindex:"0"},[t("div",ge,[t("div",fe,[e[12]||(e[12]=t("h2",{class:"text-2xl font-bold text-gray-900 mb-4"},"연습 결과",-1)),t("div",pe,[t("div",xe,[e[8]||(e[8]=t("span",{class:"text-gray-600"},"최종 WPM",-1)),t("span",me,r(k.value),1)]),t("div",ye,[e[9]||(e[9]=t("span",{class:"text-gray-600"},"정확도",-1)),t("span",be,r(_.value)+"%",1)]),t("div",he,[e[10]||(e[10]=t("span",{class:"text-gray-600"},"완료한 문자",-1)),t("span",_e,r(a.value.length)+"/"+r(u.value.length),1)]),t("div",we,[e[11]||(e[11]=t("span",{class:"text-gray-600"},"분당 타자수",-1)),t("span",ke,r(w.value),1)])])]),t("div",{class:"bg-gray-50 px-6 py-4 rounded-b-lg"},[t("button",{onClick:T,class:"w-full px-4 py-2 text-lg font-medium text-white bg-blue-600 rounded-lg hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition-colors"}," 닫기 ")])])],32)):G("",!0)]))}},Ie=F(Ce,[["__scopeId","data-v-7e646bed"]]);export{Ie as default};
