import{r as x,P as f,v as Y,k as L,c as j,w as T,L as N,s as B,o as l,a as P,b as t,d,u as y,aY as R,aZ as V,t as g,a_ as H,n as b,K as _,F as D,M as $,_ as q}from"./index-5fc67d8a.js";const z={class:"p-6 min-h-screen bg-gray-50"},E={class:"bg-gradient-to-r from-blue-50 to-indigo-50 rounded-xl p-6 mb-6 shadow-sm"},K={class:"flex items-center"},Z={class:"w-8 h-8 text-blue-600",viewBox:"0 0 24 24"},G=["d"],J={class:"grid grid-cols-5 gap-6"},Q={class:"col-span-2"},U={class:"bg-white rounded-xl shadow-sm overflow-hidden sticky top-6"},W={class:"bg-gradient-to-b from-gray-50 border-b border-gray-100 p-4"},X={class:"flex items-center justify-between"},tt={class:"w-5 h-5 text-gray-600",viewBox:"0 0 24 24"},et=["d"],st={class:"text-lg font-semibold text-gray-800"},at={class:"w-5 h-5 text-gray-600",viewBox:"0 0 24 24"},nt=["d"],ot={class:"p-4"},rt={class:"grid grid-cols-7 gap-1"},lt=["onClick"],dt={key:0,class:"absolute bottom-1 w-1.5 h-1.5 rounded-full bg-blue-400"},it={class:"col-span-3"},ct={class:"bg-white rounded-xl shadow-sm overflow-hidden"},ut={class:"border-b border-gray-100 p-6"},gt={class:"text-lg font-semibold text-gray-800"},pt={class:"p-6"},ht={class:"overflow-x-auto"},vt={class:"w-full"},xt={class:"divide-y divide-gray-100"},ft={class:"px-4 py-3 text-sm font-medium text-gray-900"},mt={class:"px-4 py-3 text-sm"},_t={key:0,class:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-purple-100 text-purple-800"},yt={key:1,class:"text-gray-600"},bt={class:"px-4 py-3 text-sm text-center"},Dt={key:0},Ct={__name:"ClassCalendar",setup(wt){const i=x(new Date().getFullYear()),c=x(new Date().getMonth()),h=x(f().format("YYYY-MM-DD")),v=x({}),w=x({}),I=Y(()=>{const a=new Date(i.value,c.value,1),s=[],e=a.getDay(),p=new Date(i.value,c.value,0);for(let o=e-1;o>=0;o--){const r=new Date(i.value,c.value-1,p.getDate()-o);s.push({date:r.toISOString().split("T")[0],current:!1,hasClasses:!!v.value[r.toISOString().split("T")[0]]})}const u=new Date(i.value,c.value+1,0);for(let o=1;o<=u.getDate();o++){const r=new Date(i.value,c.value,o);s.push({date:r.toISOString().split("T")[0],current:!0,hasClasses:!!v.value[r.toISOString().split("T")[0]]})}const n=u.getDay();for(let o=1;o<7-n;o++){const r=new Date(i.value,c.value+1,o);s.push({date:r.toISOString().split("T")[0],current:!1,hasClasses:!!v.value[r.toISOString().split("T")[0]]})}return s}),k=Y(()=>v.value[h.value]||[]);function C(a){const s=new Date(i.value,c.value+a,1);i.value=s.getFullYear(),c.value=s.getMonth(),M()}function A(a){h.value=a}function m(a){return h.value===a}function O(a){const s=new Date(a),e=["일","월","화","수","목","금","토"];return`${s.getFullYear()}년 ${s.getMonth()+1}월 ${s.getDate()}일 (${e[s.getDay()]})`}function S(a){const s=f(),e=f(a.classDate),u=(w.value[a.classDate]||[]).some(o=>o.studentId===a.student.id&&o.attendanceDate===a.classDate);if(e.isAfter(s,"day"))return"예정";if(e.isBefore(s,"day"))return u?"완료":"결석";const n=s.format("HH:mm");return n<a.startTime?"예정":n>a.endTime?u?"완료":"결석":u?"진행중":"미출석"}function F(a){switch(S(a)){case"예정":return"bg-gray-100 text-gray-600";case"진행중":return"bg-green-100 text-green-600";case"완료":return"bg-blue-100 text-blue-600";case"결석":return"bg-red-100 text-red-600";case"미출석":return"bg-yellow-100 text-yellow-600";default:return"bg-gray-100 text-gray-600"}}async function M(){try{const a=f(new Date(i.value,c.value,1)).format("YYYY-MM-DD"),s=f(new Date(i.value,c.value+1,0)).format("YYYY-MM-DD"),e=await B.get("/api/classes/range",{params:{startDate:a,endDate:s}});v.value=e.data.reduce((n,o)=>{const r=o.classDate;return n[r]||(n[r]=[]),n[r].push(o),n},{});const p=Array.from(new Set(e.data.map(n=>n.student.id))).map(n=>B.get(`/api/attendance/${n}`)),u=await Promise.all(p);w.value=u.flatMap(n=>n.data).reduce((n,o)=>{const r=o.attendanceDate;return n[r]||(n[r]=[]),n[r].push(o),n},{})}catch(a){console.error("데이터 조회 실패:",a),alert("데이터를 불러오는데 실패했습니다.")}}return L(()=>{M()}),(a,s)=>(l(),j(N,null,{default:T(()=>[P(q,null,{default:T(()=>[t("div",z,[t("div",E,[t("div",K,[(l(),d("svg",Z,[t("path",{fill:"currentColor",d:y(R)},null,8,G)])),s[2]||(s[2]=t("h1",{class:"text-2xl font-bold text-gray-800 ml-3"},"날짜별 수업 목록",-1))])]),t("div",J,[t("div",Q,[t("div",U,[t("div",W,[t("div",X,[t("button",{class:"p-2 hover:bg-gray-100 rounded-lg transition-colors",onClick:s[0]||(s[0]=e=>C(-1))},[(l(),d("svg",tt,[t("path",{fill:"currentColor",d:y(V)},null,8,et)]))]),t("h2",st,g(i.value)+"년 "+g(c.value+1)+"월 ",1),t("button",{class:"p-2 hover:bg-gray-100 rounded-lg transition-colors",onClick:s[1]||(s[1]=e=>C(1))},[(l(),d("svg",at,[t("path",{fill:"currentColor",d:y(H)},null,8,nt)]))])])]),t("div",ot,[t("div",rt,[(l(),d(D,null,b(["일","월","화","수","목","금","토"],e=>t("div",{key:e,class:_(["text-center py-2 text-sm font-medium",e==="일"?"text-red-500":e==="토"?"text-blue-500":"text-gray-600"])},g(e),3)),64)),(l(!0),d(D,null,b(I.value,({date:e,current:p,hasClasses:u})=>(l(),d("div",{key:e,class:"aspect-square p-0.5"},[t("button",{class:_(["w-full h-full rounded-lg flex flex-col items-center justify-center relative transition-all duration-200",[p?"hover:bg-blue-50":"opacity-30",m(e)?"bg-blue-500 text-white hover:bg-blue-600 shadow-sm":"",u&&!m(e)?"bg-blue-50":""]]),onClick:n=>A(e)},[t("span",{class:_(["text-sm",m(e)?"font-semibold":""])},g(new Date(e).getDate()),3),u&&!m(e)?(l(),d("div",dt)):$("",!0)],10,lt)]))),128))])])])]),t("div",it,[t("div",ct,[t("div",ut,[t("h3",gt,g(h.value?O(h.value):"날짜를 선택하세요"),1)]),t("div",pt,[t("div",ht,[t("table",vt,[s[4]||(s[4]=t("thead",null,[t("tr",{class:"border-b border-gray-100"},[t("th",{class:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"학생"),t("th",{class:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"수업 종류"),t("th",{class:"px-4 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider"},"상태")])],-1)),t("tbody",xt,[(l(!0),d(D,null,b(k.value,e=>(l(),d("tr",{key:e.id,class:"hover:bg-gray-50 transition-colors"},[t("td",ft,g(e.student.name),1),t("td",mt,[e.makeup?(l(),d("span",_t,g(e.makeupType),1)):(l(),d("span",yt,"정규수업"))]),t("td",bt,[t("span",{class:_(["inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium",F(e)])},g(S(e)),3)])]))),128)),k.value.length===0?(l(),d("tr",Dt,s[3]||(s[3]=[t("td",{colspan:"4",class:"px-4 py-8 text-center text-gray-500"}," 이 날짜에는 예정된 수업이 없습니다. ",-1)]))):$("",!0)])])])])])])])])]),_:1})]),_:1}))}};export{Ct as default};
