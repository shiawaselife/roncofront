import{r as f,O as x,v as I,k as J,c as Z,w as N,L as G,s as $,o as l,a as H,b as e,d as c,u as C,aY as K,aZ as P,t as p,a_ as Q,n as S,I as b,F as B,J as j,_ as U}from"./index-ca36a574.js";const W={class:"p-6 min-h-screen bg-gray-50"},X={class:"bg-gradient-to-r from-blue-50 to-indigo-50 rounded-xl p-6 mb-6 shadow-sm"},tt={class:"flex items-center"},et={class:"w-8 h-8 text-blue-600",viewBox:"0 0 24 24"},st=["d"],nt={class:"grid grid-cols-5 gap-6"},at={class:"col-span-2"},ot={class:"bg-white rounded-xl shadow-sm overflow-hidden sticky top-6"},lt={class:"bg-gradient-to-b from-gray-50 border-b border-gray-100 p-4"},rt={class:"flex items-center justify-between"},ct={class:"w-5 h-5 text-gray-600",viewBox:"0 0 24 24"},ut=["d"],it={class:"text-lg font-semibold text-gray-800"},dt={class:"w-5 h-5 text-gray-600",viewBox:"0 0 24 24"},gt=["d"],pt={class:"p-4"},ht={class:"grid grid-cols-7 gap-1"},ft=["onClick"],xt={key:0,class:"absolute bottom-1 w-1.5 h-1.5 rounded-full bg-blue-400"},vt={class:"col-span-3"},mt={class:"bg-white rounded-xl shadow-sm overflow-hidden"},yt={class:"border-b border-gray-100 p-6"},_t={class:"text-lg font-semibold text-gray-800"},bt={class:"p-6"},Dt={class:"overflow-x-auto"},wt={class:"w-full"},kt={class:"divide-y divide-gray-100"},Mt={class:"px-4 py-3 text-sm font-medium text-gray-900"},Yt={class:"px-4 py-3 text-sm"},$t={key:0,class:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-red-100 text-red-800"},Ct={key:1,class:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-purple-100 text-purple-800"},St={key:2,class:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800"},Bt={class:"px-4 py-3 text-sm text-gray-500"},Rt={class:"px-4 py-3 text-sm text-center"},Ft={key:0},Ot={__name:"ClassCalendar",setup(Tt){const i=f(new Date().getFullYear()),d=f(new Date().getMonth()),h=f(x().format("YYYY-MM-DD")),m=f({}),y=f({}),D=f([]);function w(s){const n=s.getFullYear(),t=String(s.getMonth()+1).padStart(2,"0"),r=String(s.getDate()).padStart(2,"0");return`${n}-${t}-${r}`}const V=I(()=>{const s=new Date(i.value,d.value,1),n=new Date(i.value,d.value+1,0),t=[],r=s.getDay();if(r>0){const a=new Date(i.value,d.value,0),v=a.getDate();for(let g=0;g<r;g++){const O=v-(r-1)+g,A=new Date(a.getFullYear(),a.getMonth(),O),Y=w(A);console.log(Y,A,O),t.push({date:Y,current:!1,hasRecords:k(Y)})}}for(let a=1;a<=n.getDate();a++){const v=new Date(i.value,d.value,a),g=w(v);t.push({date:g,current:!0,hasRecords:k(g)})}const u=6-n.getDay();if(u>0)for(let a=1;a<=u;a++){const v=new Date(i.value,d.value+1,a),g=w(v);t.push({date:g,current:!1,hasRecords:k(g)})}return t}),R=I(()=>{if(!h.value)return[];const s=(m.value[h.value]||[]).map(t=>({...t,type:"attendance"})),n=(y.value[h.value]||[]).map(t=>({...t,type:"absence"}));return[...s,...n].sort((t,r)=>{const o=M(t.studentId),u=M(r.studentId);return o.localeCompare(u)})});function k(s){return m.value[s]&&m.value[s].length>0||y.value[s]&&y.value[s].length>0}function F(s){const n=new Date(i.value,d.value+s,1);i.value=n.getFullYear(),d.value=n.getMonth(),L()}function q(s){h.value=s}function _(s){return h.value===s}function M(s){const n=D.value.find(t=>t.id===s);return n?n.name:`학생 #${s}`}function T(s){if(s.type==="absence")return"결석";{const n=x();if(x(s.attendanceDate).isAfter(n,"day"))return"예정";if(s.endTime){const r=x(`${s.attendanceDate} ${s.endTime}`);return n.isAfter(r)?"완료":"진행중"}return s.makeup?"보강":"출석"}}function z(s){switch(T(s)){case"예정":return"bg-gray-100 text-gray-600";case"진행중":return"bg-yellow-100 text-yellow-600";case"완료":return"bg-blue-100 text-blue-600";case"결석":return"bg-red-100 text-red-600";case"출석":case"보강":return"bg-green-100 text-green-600";default:return"bg-gray-100 text-gray-600"}}function E(s){const n=new Date(s),t=["일","월","화","수","목","금","토"];return`${n.getFullYear()}년 ${n.getMonth()+1}월 ${n.getDate()}일 (${t[n.getDay()]})`}async function L(){try{const s=x(new Date(i.value,d.value,1)).format("YYYY-MM-DD"),n=x(new Date(i.value,d.value+1,0)).format("YYYY-MM-DD");if(D.value.length===0){const o=await $.get("/api/students");D.value=o.data}const t=await $.get("/api/attendance/range",{params:{startDate:s,endDate:n}});m.value=t.data.reduce((o,u)=>{const a=u.attendanceDate;return o[a]||(o[a]=[]),o[a].push(u),o},{});const r=await $.get("/api/absence/range",{params:{startDate:s,endDate:n}});y.value=r.data.reduce((o,u)=>{const a=u.absenceDate;return o[a]||(o[a]=[]),o[a].push(u),o},{})}catch(s){console.error("데이터 조회 실패:",s),alert("데이터를 불러오는데 실패했습니다.")}}return J(()=>{L()}),(s,n)=>(l(),Z(G,null,{default:N(()=>[H(U,null,{default:N(()=>[e("div",W,[e("div",X,[e("div",tt,[(l(),c("svg",et,[e("path",{fill:"currentColor",d:C(K)},null,8,st)])),n[2]||(n[2]=e("h1",{class:"text-2xl font-bold text-gray-800 ml-3"},"날짜별 출결 현황",-1))])]),e("div",nt,[e("div",at,[e("div",ot,[e("div",lt,[e("div",rt,[e("button",{class:"p-2 hover:bg-gray-100 rounded-lg transition-colors",onClick:n[0]||(n[0]=t=>F(-1))},[(l(),c("svg",ct,[e("path",{fill:"currentColor",d:C(P)},null,8,ut)]))]),e("h2",it,p(i.value)+"년 "+p(d.value+1)+"월 ",1),e("button",{class:"p-2 hover:bg-gray-100 rounded-lg transition-colors",onClick:n[1]||(n[1]=t=>F(1))},[(l(),c("svg",dt,[e("path",{fill:"currentColor",d:C(Q)},null,8,gt)]))])])]),e("div",pt,[e("div",ht,[(l(),c(B,null,S(["일","월","화","수","목","금","토"],t=>e("div",{key:t,class:b(["text-center py-2 text-sm font-medium",t==="일"?"text-red-500":t==="토"?"text-blue-500":"text-gray-600"])},p(t),3)),64)),(l(!0),c(B,null,S(V.value,({date:t,current:r,hasRecords:o})=>(l(),c("div",{key:t,class:"aspect-square p-0.5"},[e("button",{class:b(["w-full h-full rounded-lg flex flex-col items-center justify-center relative transition-all duration-200",[r?"hover:bg-blue-50":"opacity-30",_(t)?"bg-blue-500 text-white hover:bg-blue-600 shadow-sm":"",o&&!_(t)?"bg-blue-50":""]]),onClick:u=>q(t)},[e("span",{class:b(["text-sm",_(t)?"font-semibold":""])},p(new Date(t).getDate()),3),o&&!_(t)?(l(),c("div",xt)):j("",!0)],10,ft)]))),128))])])])]),e("div",vt,[e("div",mt,[e("div",yt,[e("h3",_t,p(h.value?E(h.value):"날짜를 선택하세요"),1)]),e("div",bt,[e("div",Dt,[e("table",wt,[n[4]||(n[4]=e("thead",null,[e("tr",{class:"border-b border-gray-100"},[e("th",{class:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"학생"),e("th",{class:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"종류"),e("th",{class:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"시간"),e("th",{class:"px-4 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider"},"상태")])],-1)),e("tbody",kt,[(l(!0),c(B,null,S(R.value,t=>(l(),c("tr",{key:`${t.type}-${t.id}`,class:"hover:bg-gray-50 transition-colors"},[e("td",Mt,p(M(t.studentId)),1),e("td",Yt,[t.type==="absence"?(l(),c("span",$t," 결석 ")):t.makeup?(l(),c("span",Ct,p(t.makeupType||"보강"),1)):(l(),c("span",St," 일반 출석 "))]),e("td",Bt,p(t.type==="absence"?"-":`${t.startTime||"-"} ~ ${t.endTime||"-"}`),1),e("td",Rt,[e("span",{class:b(["inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium",z(t)])},p(T(t)),3)])]))),128)),R.value.length===0?(l(),c("tr",Ft,n[3]||(n[3]=[e("td",{colspan:"4",class:"px-4 py-8 text-center text-gray-500"}," 이 날짜에는 출결 기록이 없습니다. ",-1)]))):j("",!0)])])])])])])])])]),_:1})]),_:1}))}};export{Ot as default};
