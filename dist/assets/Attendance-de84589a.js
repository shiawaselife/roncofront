import{_ as F,u as R,o as S,r as x,c as m,a as U,A as v,b as d,d as q,w as C,e as P,f as g,g as t,h as z,v as G,t as n,i as r,j as D,k as T,F as M,l as $,m as H,n as J,p as K,q as Q,s as X}from"./index-4925a545.js";const i=u=>(Q("data-v-cef31971"),u=u(),X(),u),Y={class:"flex flex-col md:flex-row items-start md:items-center justify-between mb-6 space-y-4 md:space-y-0"},Z={class:"text-lg font-semibold text-gray-700"},tt={class:"mb-8"},et=i(()=>t("h2",{class:"text-2xl font-bold mb-4 text-gray-800"},"등원 아직 안 한 사람",-1)),st={class:"overflow-x-auto"},at={class:"min-w-full bg-white rounded-lg shadow overflow-hidden"},nt=i(()=>t("thead",{class:"bg-blue-500 text-white"},[t("tr",null,[t("th",{class:"py-3 px-6 text-left"},"이름"),t("th",{class:"py-3 px-6 text-left"},"전화번호"),t("th",{class:"py-3 px-6 text-left"},"생년월일"),t("th",{class:"py-3 px-6 text-left"},"수업 요일"),t("th",{class:"py-3 px-6 text-left"},"수업 시간"),t("th",{class:"py-3 px-6 text-left"},"커리큘럼"),t("th",{class:"py-3 px-6 text-center"},"액션")])],-1)),ct={class:"py-4 px-6"},ot={class:"py-4 px-6"},lt={class:"py-4 px-6"},dt={class:"py-4 px-6"},rt={class:"py-4 px-6"},it={class:"py-4 px-6"},pt={class:"py-4 px-6 text-center"},ut={key:0,class:"bg-gray-50"},ht=i(()=>t("td",{colspan:"7",class:"py-4 px-6 text-center text-gray-500"}," 등원할 학생이 없습니다. ",-1)),_t=[ht],xt=i(()=>t("h2",{class:"text-2xl font-bold mb-4 text-gray-800"},"등원한 사람",-1)),ft={class:"overflow-x-auto"},yt={class:"min-w-full bg-white rounded-lg shadow overflow-hidden"},mt=i(()=>t("thead",{class:"bg-green-500 text-white"},[t("tr",null,[t("th",{class:"py-3 px-6 text-left"},"이름"),t("th",{class:"py-3 px-6 text-left"},"전화번호"),t("th",{class:"py-3 px-6 text-left"},"생년월일"),t("th",{class:"py-3 px-6 text-left"},"등원 시간"),t("th",{class:"py-3 px-6 text-left"},"남은 시간"),t("th",{class:"py-3 px-6 text-left"},"커리큘럼"),t("th",{class:"py-3 px-6 text-center"},"액션")])],-1)),vt={class:"py-4 px-6"},gt={class:"py-4 px-6"},wt={class:"py-4 px-6"},bt={class:"py-4 px-6"},kt={class:"py-4 px-6"},It={class:"py-4 px-6"},At={class:"py-4 px-6 text-center"},St={key:0,class:"bg-gray-50"},Ct=i(()=>t("td",{colspan:"7",class:"py-4 px-6 text-center text-gray-500"}," 등원한 학생이 없습니다. ",-1)),Dt=[Ct],Tt={__name:"Attendance",setup(u){const f=R(),{clients:h}=f;S(()=>{f.fetchSampleClients()});const o=x([]),y=x(""),w={mon:"월요일",tue:"화요일",wed:"수요일",thu:"목요일",fri:"금요일",sat:"토요일",sun:"일요일"},b=x((()=>{const s=["sun","mon","tue","wed","thu","fri","sat"],a=new Date().getDay();return s[a]})()),l=x([]),k=m(()=>{if(!h||h.length===0)return[];const s=y.value.trim().toLowerCase();return h.filter(a=>{const e=a.daysOfWeek&&a.daysOfWeek.includes(b.value),c=!s||a.name.toLowerCase().includes(s);return e&&c})}),O=async s=>{try{const a=await v.markAttendance(s.id);o.value.includes(s.id)||o.value.push(s.id),l.value.push({student:s,attendance:a.data})}catch(a){console.error(a),alert("등원 체크 중 오류가 발생했습니다.")}},B=async s=>{try{await v.cancelAttendance(s.id);const a=o.value.indexOf(s.id);a!==-1&&o.value.splice(a,1);const e=l.value.findIndex(c=>c.attendance.id===s.id);e!==-1&&l.value.splice(e,1)}catch(a){console.error(a),alert("등원 취소 중 오류가 발생했습니다.")}};let p=null;const W=()=>{p&&clearInterval(p),p=setInterval(()=>{l.value=[...l.value]},1e3)};U(()=>{p&&clearInterval(p)});const I=s=>o.value.includes(s),A=m(()=>k.value.filter(s=>!I(s.id))),L=m(()=>k.value.filter(s=>I(s.id)));S(async()=>{await f.fetchSampleClients();try{const{data:s}=await v.getTodayAttendance();s.forEach(a=>{const e=h.find(c=>c.id===a.studentId);e&&(l.value.push({student:e,attendance:a}),o.value.includes(e.id)||o.value.push(e.id))})}catch(s){console.error("오늘 등원 정보 가져오기 실패:",s)}W()});const V=s=>{const a=new Date,e=new Date(s),_=new Date(e.getTime()+90*60*1e3)-a;if(_<=0)return"0:00:00";const j=Math.floor(_/(1e3*60*60)),N=Math.floor(_%(1e3*60*60)/(1e3*60)),E=Math.floor(_%(1e3*60)/1e3);return`${j}:${String(N).padStart(2,"0")}:${String(E).padStart(2,"0")}`};return(s,a)=>(d(),q(P,null,{default:C(()=>[g(J,null,{default:C(()=>[t("div",Y,[z(t("input",{"onUpdate:modelValue":a[0]||(a[0]=e=>y.value=e),type:"text",placeholder:"이름 검색",class:"border border-gray-300 px-4 py-2 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 w-full md:w-1/3"},null,512),[[G,y.value]]),t("div",Z,n(w[b.value])+" 등원 명단 ",1)]),t("div",tt,[et,t("div",st,[t("table",at,[nt,t("tbody",null,[(d(!0),r(M,null,D(A.value,e=>(d(),r("tr",{key:e.id,class:"border-b hover:bg-gray-100"},[t("td",ct,n(e.name),1),t("td",ot,n(e.phone),1),t("td",lt,n(e.birthday),1),t("td",dt,n(e.daysOfWeek.map(c=>w[c]).join(", ")),1),t("td",rt,n(e.schedule),1),t("td",it,n(e.curriculum),1),t("td",pt,[g(T,{color:"info",label:"등원",onClick:c=>O(e),class:"px-3 py-1 text-sm"},null,8,["onClick"])])]))),128)),A.value.length===0?(d(),r("tr",ut,_t)):$("",!0)])])])]),t("div",null,[xt,t("div",ft,[t("table",yt,[mt,t("tbody",null,[(d(!0),r(M,null,D(l.value,e=>(d(),r("tr",{key:e.student.id,class:"border-b hover:bg-gray-100"},[t("td",vt,n(e.student.name),1),t("td",gt,n(e.student.phone),1),t("td",wt,n(e.student.birthday),1),t("td",bt,n(H(K)(e.attendance.createdAt)),1),t("td",kt,n(V(e.attendance.createdAt)),1),t("td",It,n(e.student.curriculum),1),t("td",At,[g(T,{color:"danger",label:"취소",onClick:c=>B(e.student),class:"px-3 py-1 text-sm"},null,8,["onClick"])])]))),128)),L.value.length===0?(d(),r("tr",St,Dt)):$("",!0)])])])])]),_:1})]),_:1}))}},Ot=F(Tt,[["__scopeId","data-v-cef31971"]]);export{Ot as default};
